<Application xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             x:Class="DockTemplate.App"
             xmlns:local="using:DockTemplate"
             xmlns:core="clr-namespace:Dock.Model.Core;assembly=Dock.Model"
             xmlns:avalonia="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
             xmlns:avaloniaEdit="https://github.com/avaloniaui/avaloniaedit"
             RequestedThemeVariant="Dark">
             <!-- "Default" ThemeVariant follows system theme variant. "Dark" or "Light" are other available options. -->

    <Application.DataTemplates>
        <local:ViewLocator/>
    </Application.DataTemplates>
  
  <Application.Resources>
    
    <ResourceDictionary>
      <ResourceDictionary.MergedDictionaries>
        
        <ResourceDictionary>
          <ControlRecycling x:Key="ControlRecyclingKey" />
        </ResourceDictionary>

        <ResourceDictionary>
          <ResourceDictionary.ThemeDictionaries>
            <ResourceDictionary x:Key='Default'>
              <SolidColorBrush x:Key="TextControlBackground">#EFEFEF</SolidColorBrush>
              <SolidColorBrush x:Key="TextControlBackgroundFocused">#EFEFEF</SolidColorBrush>
              <SolidColorBrush x:Key="TextControlBackgroundPointerOver">#EFEFEF</SolidColorBrush>
              <SolidColorBrush x:Key="TextControlForeground">#212121</SolidColorBrush>
              <SolidColorBrush x:Key="TextForegroundColor">#212121</SolidColorBrush>
              <SolidColorBrush x:Key="TextControlBorderBrush">#33323232</SolidColorBrush>
              <SolidColorBrush x:Key="TextControlBorderBrushPointerOver">#33323232</SolidColorBrush>
              <Color x:Key="RegionColor">#FFFAFAFA</Color>
              <Color x:Key="AcrylicFallbackColor">#E2E2E2</Color>
              
              <!-- VS Code Light Theme Editor Colors -->
              <SolidColorBrush x:Key="EditorBackground">#FFFFFF</SolidColorBrush>
              <SolidColorBrush x:Key="EditorForeground">#1E1E1E</SolidColorBrush>
              <SolidColorBrush x:Key="EditorLineNumberForeground">#237893</SolidColorBrush>
              <SolidColorBrush x:Key="EditorSelectionBackground">#ADD6FF</SolidColorBrush>
            </ResourceDictionary>
            <ResourceDictionary x:Key='Dark'>
              <SolidColorBrush x:Key="TextControlBackground">#2F2F2F</SolidColorBrush>
              <SolidColorBrush x:Key="TextControlBackgroundFocused">#2F2F2F</SolidColorBrush>
              <SolidColorBrush x:Key="TextControlBackgroundPointerOver">#2F2F2F</SolidColorBrush>
              <SolidColorBrush x:Key="TextControlForeground">#FFFFFF</SolidColorBrush>
              <SolidColorBrush x:Key="TextForegroundColor">#FFFFFF</SolidColorBrush>
              <SolidColorBrush x:Key="TextControlBorderBrush">#434343</SolidColorBrush>
              <SolidColorBrush x:Key="TextControlBorderBrushPointerOver">#434343</SolidColorBrush>
              <Color x:Key="RegionColor">#FF212121</Color>
              <Color x:Key="AcrylicFallbackColor">#1F1F1F</Color>
              
              <!-- VS Code Dark Theme Editor Colors -->
              <SolidColorBrush x:Key="EditorBackground">#1E1E1E</SolidColorBrush>
              <SolidColorBrush x:Key="EditorForeground">#CCCCCC</SolidColorBrush>
              <SolidColorBrush x:Key="EditorLineNumberForeground">#858585</SolidColorBrush>
              <SolidColorBrush x:Key="EditorSelectionBackground">#264F78</SolidColorBrush>
            </ResourceDictionary>
          </ResourceDictionary.ThemeDictionaries>
        </ResourceDictionary>
        </ResourceDictionary.MergedDictionaries>
        
        <!-- Try to override potential hardcoded dock theme brushes -->
        <SolidColorBrush x:Key="SystemControlHighlightAccentBrush" Color="{DynamicResource SystemAccentColor}" />
        <SolidColorBrush x:Key="SystemAccentColorBrush" Color="{DynamicResource SystemAccentColor}" />
        <SolidColorBrush x:Key="HighlightBrush" Color="{DynamicResource SystemAccentColor}" />
      
    </ResourceDictionary>

  </Application.Resources>

  <Application.Styles>

    <FluentTheme />
    <DockFluentTheme />

    <StyleInclude Source="avares://AvaloniaEdit/Themes/Fluent/AvaloniaEdit.xaml" />
    <StyleInclude Source="avares://Avalonia.Controls.DataGrid/Themes/Fluent.xaml"/>

    <avalonia:MaterialIconStyles />

    <StyleInclude Source="avares://AvaloniaProgressRing/Styles/ProgressRing.xaml"/>

    <Style Selector="DockControl">
      <Setter Property="(ControlRecyclingDataTemplate.ControlRecycling)" Value="{StaticResource ControlRecyclingKey}" />
    </Style>

    <Style Selector="DocumentControl">
      <Setter Property="IconTemplate">
        <DataTemplate DataType="core:IDockable">
          <PathIcon
            Data="M5 1C3.89543 1 3 1.89543 3 3V13C3 14.1046 3.89543 15 5 15H11C12.1046 15 13 14.1046 13 13V5.41421C13 5.01639 12.842 4.63486 12.5607 4.35355L9.64645 1.43934C9.36514 1.15804 8.98361 1 8.58579 1H5ZM4 3C4 2.44772 4.44772 2 5 2H8V4.5C8 5.32843 8.67157 6 9.5 6H12V13C12 13.5523 11.5523 14 11 14H5C4.44772 14 4 13.5523 4 13V3ZM11.7929 5H9.5C9.22386 5 9 4.77614 9 4.5V2.20711L11.7929 5Z"
            Width="16"
            Height="16"
            Margin="0"
            Padding="0,0,2,0" />
        </DataTemplate>
      </Setter>
    </Style>

    <Style Selector="DocumentControl">
      <Setter Property="HeaderTemplate">
        <DataTemplate DataType="core:IDockable">
          <TextBlock Text="{Binding Title}" 
                     VerticalAlignment="Center"
                     Padding="2"
                     FontSize="12" />
        </DataTemplate>
      </Setter>
    </Style>

    <Style Selector="ToolControl">
      <Setter Property="HeaderTemplate">
        <DataTemplate DataType="core:IDockable">
          <TextBlock Text="{Binding Title}" 
                     Padding="2"
                     FontSize="12" />
        </DataTemplate>
      </Setter>
    </Style>

    <Style Selector="ToolChromeControl">
      <Setter Property="Background" Value="Transparent" />
    </Style>

    <!-- Fix font sizes for collapsed tool titles and other dock controls -->
    <Style Selector="ToolChromeControl TextBlock">
      <Setter Property="FontSize" Value="12" />
    </Style>
    
    <Style Selector="DockTarget TextBlock">
      <Setter Property="FontSize" Value="12" />
    </Style>
    
    <!-- Target collapsed/minimized tool tabs specifically -->
    <Style Selector="ToolTabStripItem TextBlock">
      <Setter Property="FontSize" Value="12" />
    </Style>
    
    <Style Selector="ToolTabStrip TextBlock">
      <Setter Property="FontSize" Value="12" />
    </Style>
    
    <!-- Catch any remaining dock framework text elements -->
    <Style Selector="DockControl TextBlock">
      <Setter Property="FontSize" Value="12" />
    </Style>
    
    <!-- Ensure consistent font sizes across all dock-related text -->
    <Style Selector="DocumentControl TextBlock">
      <Setter Property="FontSize" Value="12" />
    </Style>
    
    <Style Selector="ToolControl TextBlock">  
      <Setter Property="FontSize" Value="12" />
    </Style>

    <!-- Force Document Tabs to use System Accent Color -->
    <Style Selector="DocumentTabStripItem">
      <Setter Property="Background" Value="Transparent" />
      <Setter Property="BorderBrush" Value="Transparent" />
      <Setter Property="BorderThickness" Value="0" />
    </Style>

    <Style Selector="DocumentTabStripItem:selected">
      <Setter Property="Background" Value="{DynamicResource SystemAccentColor}" />
      <Setter Property="BorderBrush" Value="{DynamicResource SystemAccentColor}" />
      <Setter Property="BorderThickness" Value="0,0,0,3" />
      <Setter Property="Foreground" Value="{DynamicResource SystemAccentColorLight3}" />
    </Style>

    <Style Selector="DocumentTabStripItem:selected /template/ ContentPresenter">
      <Setter Property="Background" Value="{DynamicResource SystemAccentColor}" />
      <Setter Property="TextElement.Foreground" Value="{DynamicResource SystemAccentColorLight3}" />
    </Style>

    <Style Selector="DocumentTabStripItem:pointerover:not(:selected)">
      <Setter Property="Background" Value="{DynamicResource SystemAccentColorLight2}" />
    </Style>

    <!-- Override any existing tab background colors -->
    <Style Selector="DocumentTabStripItem /template/ ContentPresenter">
      <Setter Property="Background" Value="Transparent" />
    </Style>

    <Style Selector="DocumentTabStripItem:selected /template/ ContentPresenter">
      <Setter Property="Background" Value="{DynamicResource SystemAccentColor}" />
      <Setter Property="TextElement.Foreground" Value="White" />
    </Style>

    <!-- Force Tool Tabs to use System Accent Color -->
    <Style Selector="ToolTabStripItem">
      <Setter Property="Background" Value="Transparent" />
      <Setter Property="BorderBrush" Value="Transparent" />
      <Setter Property="BorderThickness" Value="0" />
    </Style>

    <Style Selector="ToolTabStripItem:selected">
      <Setter Property="Background" Value="{DynamicResource SystemAccentColor}" />
      <Setter Property="BorderBrush" Value="{DynamicResource SystemAccentColor}" />
      <Setter Property="BorderThickness" Value="0,0,0,3" />
      <Setter Property="Foreground" Value="White" />
    </Style>

    <Style Selector="ToolTabStripItem:selected /template/ ContentPresenter">
      <Setter Property="Background" Value="{DynamicResource SystemAccentColor}" />
      <Setter Property="TextElement.Foreground" Value="White" />
    </Style>

    <Style Selector="ToolTabStripItem:pointerover:not(:selected)">
      <Setter Property="Background" Value="{DynamicResource SystemAccentColorLight2}" />
    </Style>

    <!-- Override any existing tool tab background colors -->
    <Style Selector="ToolTabStripItem /template/ ContentPresenter">
      <Setter Property="Background" Value="Transparent" />
    </Style>

    <Style Selector="ToolTabStripItem:selected /template/ ContentPresenter">
      <Setter Property="Background" Value="{DynamicResource SystemAccentColor}" />
      <Setter Property="TextElement.Foreground" Value="White" />
    </Style>

    <!-- Fix any hardcoded tab border/accent colors in the internal template -->
    <Style Selector="DocumentTabStripItem /template/ Border">
      <Setter Property="BorderBrush" Value="Transparent" />
    </Style>

    <Style Selector="DocumentTabStripItem:selected /template/ Border">
      <Setter Property="BorderBrush" Value="{DynamicResource SystemAccentColor}" />
    </Style>

    <Style Selector="ToolTabStripItem /template/ Border">
      <Setter Property="BorderBrush" Value="Transparent" />
    </Style>

    <Style Selector="ToolTabStripItem:selected /template/ Border">
      <Setter Property="BorderBrush" Value="{DynamicResource SystemAccentColor}" />
    </Style>
    
    <!-- Override any hardcoded blue borders in DocumentTabStripItem -->
    <Style Selector="DocumentTabStripItem Border">
      <Setter Property="BorderBrush" Value="Transparent" />
    </Style>
    
    <Style Selector="DocumentTabStripItem:selected Border">
      <Setter Property="BorderBrush" Value="{DynamicResource SystemAccentColor}" />
    </Style>
    
    <!-- Target the specific DocumentDockControl template elements -->
    <Style Selector="DocumentDockControl Border">
      <Setter Property="BorderBrush" Value="Transparent" />
    </Style>
    
    <Style Selector="DocumentDockControl TabStripItem:selected Border">
      <Setter Property="BorderBrush" Value="{DynamicResource SystemAccentColor}" />
    </Style>
    
    <!-- Override any TabStrip borders -->
    <Style Selector="TabStrip Border">
      <Setter Property="BorderBrush" Value="Transparent" />
    </Style>
    
    <Style Selector="TabStripItem:selected Border">
      <Setter Property="BorderBrush" Value="{DynamicResource SystemAccentColor}" />
    </Style>
    
    <!-- Nuclear option - override ALL blue brushes -->
    <Style Selector="DocumentTabStripItem">
      <Setter Property="BorderBrush" Value="Transparent" />
    </Style>
    
    <!-- Try to override any template selector that might have blue -->
    <Style Selector="DocumentTabStripItem > Border">
      <Setter Property="BorderBrush" Value="Transparent" />
    </Style>
    
    <Style Selector="DocumentTabStripItem:selected > Border">
      <Setter Property="BorderBrush" Value="{DynamicResource SystemAccentColor}" />
    </Style>
    
    <!-- Override any Rectangle that might be creating the blue line -->
    <Style Selector="DocumentTabStripItem Rectangle">
      <Setter Property="Fill" Value="Transparent" />
    </Style>
    
    <Style Selector="DocumentTabStripItem:selected Rectangle">
      <Setter Property="Fill" Value="{DynamicResource SystemAccentColor}" />
    </Style>
    
    <!-- Target PART_Grid in different states -->
    <Style Selector="DocumentDockControl Grid#PART_Grid">
      <Setter Property="Background" Value="Transparent" />
    </Style>
    
    <Style Selector="DocumentDockControl:active Grid#PART_Grid">
      <Setter Property="Background" Value="{DynamicResource SystemAccentColor}" />
    </Style>
    
    <Style Selector="DocumentDockControl:focus Grid#PART_Grid">
      <Setter Property="Background" Value="{DynamicResource SystemAccentColor}" />
    </Style>
    
    <Style Selector="DocumentControl:active Grid#PART_Grid">
      <Setter Property="Background" Value="{DynamicResource SystemAccentColor}" />
    </Style>
    
    <Style Selector="ContentControl Border:focus">
      <Setter Property="BorderBrush" Value="{DynamicResource SystemAccentColor}" />
    </Style>
    
    <Style Selector="Border:focus">
      <Setter Property="BorderBrush" Value="{DynamicResource SystemAccentColor}" />
    </Style>
    
    <!-- Target any focused visual elements in documents -->
    <Style Selector="UserControl:focus Border">
      <Setter Property="BorderBrush" Value="{DynamicResource SystemAccentColor}" />
    </Style>
    
    <!-- Document container focus borders -->
    <Style Selector="DocumentControl:focus Border">
      <Setter Property="BorderBrush" Value="{DynamicResource SystemAccentColor}" />
    </Style>
    
    <!-- Document content focus borders -->
    <Style Selector="DocumentControl Border:focus">
      <Setter Property="BorderBrush" Value="{DynamicResource SystemAccentColor}" />
    </Style>
    
    <!-- Any control with focus within document -->
    <Style Selector="DocumentControl:focus">
      <Setter Property="BorderBrush" Value="{DynamicResource SystemAccentColor}" />
    </Style>
    
    <!-- AvaloniaEdit focus border -->
    <Style Selector="avaloniaEdit|TextEditor:focus">
      <Setter Property="BorderBrush" Value="{DynamicResource SystemAccentColor}" />
    </Style>
    
    <!-- Any TextEditor border when focused -->
    <Style Selector="avaloniaEdit|TextEditor Border:focus">
      <Setter Property="BorderBrush" Value="{DynamicResource SystemAccentColor}" />
    </Style>

    <!-- 🎛️ ScrollViewer & Scrollbars -->
    <Style Selector="ScrollViewer">
      <Setter Property="AllowAutoHide" Value="True" />
    </Style>

    <Style Selector="ScrollBar">
      <Setter Property="AllowAutoHide" Value="True" />
    </Style>
  </Application.Styles>
</Application>